services:
  cfzt-sync:
    # image: localhost:5000/cfzt-sync
    image: {{ image }}:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - cfzt-sync-network
    environment:
      - CLOUDFLARE_API_EMAIL={{ lookup('ansible.builtin.env', 'CLOUDFLARE_API_EMAIL') }}
      - CLOUDFLARE_API_KEY={{ lookup('ansible.builtin.env', 'CLOUDFLARE_API_KEY') }}
      - CLOUDFLARE_ACCOUNT_ID={{ lookup('ansible.builtin.env', 'CLOUDFLARE_ACCOUNT_ID') }}
      - CLOUDFLARE_TUNNEL_ID={{ cloudflare_tunnel.tunnel_id }}
      - CLOUDFLARE_ZONE_ID={{ zone }}

networks:
  cfzt-sync-network:
    driver: overlay
